<!DOCTYPE html>
<html lang="en">

    <head>

        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Main page</title>
     
        <!-- CSS -->
        
        <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:400,100,300,500">     
        <link rel="stylesheet" href="../assets/bootstrap/css/bootstrap.min.css">
        <link rel="stylesheet" href="../assets/font-awesome/css/font-awesome.min.css">
		<link rel="stylesheet" href="../assets/css/form-elements.css">
        <link rel="stylesheet" href="../assets/css/style.css">
        <link rel="stylesheet" href="../assets/css/animate.css">

        <!-- Javascript -->
        <script src="../assets/js/jquery-1.12.3.min.js"></script>
        <script src="../assets/bootstrap/js/bootstrap.min.js"></script>
        <script src="../assets/js/jquery.backstretch.min.js"></script>
        <script src="../assets/js/scripts.js"></script>
        <script src="../assets/js/wow.min.js"></script>
        <script src="require.js"></script>
        <!--[if lt IE 10]>
        <!--[if lt IE 10]>
            <script src="assets/js/placeholder.js"></script>
        <![endif]-->
        
        <!-- customized timeline viewer CSS-->
        <link title="timeline-styles" rel="stylesheet" href="https://cdn.knightlab.com/libs/timeline3/latest/css/timeline.css">
        <link title="timeline-styles" rel="stylesheet" href="https://cdn.knightlab.com/libs/timeline3/latest/css/fonts/font.clicker-garamond.css">

        <!-- customized timeline viewer Javascript -->
        <script src="https://cdn.knightlab.com/libs/timeline3/latest/js/timeline.js"></script>
        

        <style>
        
            .div_margin_top {
                margin-top: 63px;
            }
            p {
                color: linen;
            }
            .timeline_size {
                width: 100%;
                height: 600px;
            }
            hr {
                border-top: 2px dashed #eee;
            }
            .navbar-customized-color {
                background-color: white;
            }
            .hover_effect:hover {
                color: #2d0202;
                background-color: #eee;
            }
        </style>

    </head>

    <body>
        <!-- menu bar -->
            <nav class="navbar navbar-fixed-top navbar-customized-color">
              <div class="container">
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                      </button>
                      <a  class="navbar-brand hover_effect" data-toggle="tooltip" data-placement="bottom" title="Edit here" href="#">Edit here</a>
                    </div>
                    <div id="navbar" class="navbar-collapse collapse">
                      <ul class="nav navbar-nav">
                        <li class="dropdown">
                          <a class="hover_effect dropdown-toggle" href="#"  data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false" >Edit here<span class="caret"></span></a>
                          <ul class="dropdown-menu">
                            <li><a href="#">Edit here</a></li>
                            <li role="separator" class="divider"></li>
                            <li><a href="#">Edit here</a></li>
                          </ul>
                        </li>
                        <li><a class="hover_effect" href="#" data-toggle="tooltip" data-placement="bottom" title="Edit here">Edit here</a></li>
                        <li><a class="hover_effect" href="#" data-toggle="tooltip" data-placement="bottom" title="Edit here">Edit here</a></li>
                        <li><a class="hover_effect" href="#" data-toggle="tooltip" data-placement="bottom" title="Edit here" >Edit here</a></li>

                      </ul>
                      <ul class="nav navbar-nav navbar-right">

                        <li><a class="hover_effect" href="#" data-toggle="tooltip" data-placement="bottom" title="Edit here"><i class="fa fa-bell-o fa-2x" aria-hidden="true"></i>Edit here</a></li>
                        <li><a class="hover_effect" href="#" data-toggle="tooltip" data-placement="bottom" title="Edit here"><i class="fa fa-sign-out fa-2x" aria-hidden="true"></i>Edit here</a></li>
                      </ul>
                    </div><!--/.nav-collapse -->
              </div>
            </nav>
     
        <div class="div_margin_top">
        
        <p><strong>Design for repository here! still trying to find out a way for showing repository with the good UI design including certain funcationalites</strong></p>
        </div>

        <hr>
        
<!--
        <p>simplest way</p>
         simplest way 
        <div>     
        <iframe src='https://cdn.knightlab.com/libs/timeline3/latest/embed/index.html?source=1IgkgzK1KCoFYLd0hutJwzAUaRd7Xvss1mMjdlq1Lzs0&font=Default&lang=en&initial_zoom=2&height=650' width='100%' height='650' webkitallowfullscreen mozallowfullscreen allowfullscreen frameborder='0'></iframe>
        </div>
-->
        
        <p>customized timeline view</p>
        <!-- could do some customization -->
        <div class="padding_top timeline_size" id='timeline-embed'></div>
        <script src="https://www.gstatic.com/firebasejs/3.6.9/firebase.js"></script>
        <script>
          // Initialize Firebase
          var config = {
            apiKey: "AIzaSyD6ZC7v1hVtN1_gNo5M-MbUoXGv6sZXrJE",
            authDomain: "capstone2017-4504b.firebaseapp.com",
            databaseURL: "https://capstone2017-4504b.firebaseio.com",
            storageBucket: "capstone2017-4504b.appspot.com",
            messagingSenderId: "739463464766"
          };
          firebase.initializeApp(config);
        </script>


<!-- <script src="https://www.gstatic.com/firebasejs/3.6.10/firebase.js"></script>
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyBzNFeJ1_cAFRQ31oZspELDwhStyNCs_6s",
    authDomain: "test-1216f.firebaseapp.com",
    databaseURL: "https://test-1216f.firebaseio.com",
    storageBucket: "test-1216f.appspot.com",
    messagingSenderId: "525817377297"
  };
  firebase.initializeApp(config);
</script> -->
        <script type="text/javascript">
      // The TL.Timeline constructor takes at least two arguments:
      // the id of the Timeline container (no '#'), and
      // the URL to your JSON data file or Google spreadsheet.
      // the id must refer to an element "above" this code,
      // and the element must have CSS styling to give it width and height
      // optionally, a third argument with configuration options can be passed.
      // See below for more about options. timenav_position
        // var timeline_json;
        // $.getJSON("http://localhost:8888/ericsong.com/test2.json", function(json) {
        //     console.log(json); // this will show the info it in firebug console
        //     //console.log(json.events);
        //     timeline_json = json;
        //     console.log(timeline_json);
        //     timeline = new TL.Timeline('timeline-embed',timeline_json, options);
        // });
        //console.log(timeline_json);
          var my_json;
          const dbRefRepo = firebase.database().ref();
          var repo_id;
            dbRefRepo.on('value', snap => {
                        // repo_id = snap.child('users').child('t0b0MJbprQdOBoXU9BiV0zmYymA2').child('repositories').val();
                        //console.log(repo_id);
                        var target_repo_id = sessionStorage.getItem("sent");
                        console.log(target_repo_id);
                        //var x = <?php echo $_POST["comentonpost"] ?>
                        //console.log(uid);
                        var photo_array = new Array();
                        var match =false;
                        var photo_id;
                        var photo_info = new Array();
                        var repo_info = snap.child('repositories').child(target_repo_id).val();
                        //target_repo_id = "-Ke-fv2rM_Xklj9CJr1t";
                        //console.log(Object.keys(repo_id).length);
                        // for( var i = 0; i < Object.keys(repo_id).length ; i++ ){
                        //     var checking_id = Object.keys(repo_id)[i];
                        //     if(checking_id == target_repo_id){
                        //         match = true;
                        //         break;
                        //     }
                        // }
                        //console.log(match);
                        photo_id = snap.child('repositories').child(target_repo_id).child('photos').val();
                        for(var i = 0; i < Object.keys(photo_id).length ; i++ ){
                            photo_array.push(Object.keys(photo_id)[i]);
                        }
                        
                        for(var i = 0; i < photo_array.length; i++ ){
                            photo_info.push(snap.child('photographs').child(photo_array[i]).val());
                            
                        }
                        console.log(photo_info);
                //var whole_json = snap.val();
                // var time = photo_info[0].date_taken;
                // console.log(time);
                // time =time.split('-');
                // console.log(time);


                var json_string = {
                                    "title": {
                                        "media": {
                                          "url": repo_info.thumbnailUrl,
                                          "caption": "Whitney Houston performing on her My Love is Your Love Tour in Hamburg.",
                                          "credit": "flickr/<a href='http://www.flickr.com/photos/tm_10001/'>tm_10001</a>"
                                        },
                                        "text": {
                                          "headline": repo_info.title,
                                          "text": repo_info.longDescription,
                                        }
                                    },
                                    "events": [

                                    ]
                                }
                for(var i = 0 ; i < photo_array.length; i ++){
                    if(photo_info[i] != null){
                    var time = photo_info[i].date_taken;
                    time =time.split('-');
                    console.log(time);
                    var new_event = {
                                        "media": {
                                          "url": photo_info[i].main_url,
                                          "caption": photo_info[i].description,
                                          "credit": "should be something in the DB"
                                        },
                                        "start_date": {
                                          "month": time[1],
                                          "day": time[2],
                                          "year": time[0]
                                        },
                                        "text": {
                                          "headline": photo_info[i].title,
                                          "text": "Also should be done by our decent DB team"
                                        }
                                    }
                    var event_length = Object.keys(json_string['events']).length;
                    json_string['events'][event_length] = new_event;  
                }
                }

                console.log(json_string);
                console.log(json_string['events']);
                console.log(json_string);
                timeline = new TL.Timeline('timeline-embed',json_string, options);
                //console.log(my_json.events);
            });

            var options = {
                    timenav_position: "top"
            }
        
        </script>
        <hr>
           


    </body>

</html>
